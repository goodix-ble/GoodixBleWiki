<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BLE常见异常说明 &mdash; Goodix BLE Start Guide v1.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5a3fd9cb"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/translations.js?v=beaddf03"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="常见问题" href="../../%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/index.html" />
    <link rel="prev" title="BLE" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Goodix BLE Start Guide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">Menu List</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../%E5%BC%80%E5%8F%91%E5%90%91%E5%AF%BC/index.html">开发向导</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/index.html">技术方案</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">应用笔记</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../SPI%E4%B8%8EQSPI/index.html">SPI与QSPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DMA/index.html">DMA</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">BLE</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">BLE常见异常说明</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">1. BLE 断连原因介绍分析</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">2. 常见断连原因</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/index.html">常见问题</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Goodix BLE Start Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">应用笔记</a></li>
          <li class="breadcrumb-item"><a href="index.html">BLE</a></li>
      <li class="breadcrumb-item active">BLE常见异常说明</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/应用笔记/BLE/BLE常见异常说明.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ble">
<h1>BLE常见异常说明<a class="headerlink" href="#ble" title="Link to this heading"></a></h1>
<p>[TOC]</p>
<section id="id1">
<h2>1. BLE 断连原因介绍分析<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>BLE 断连事件的event中有断连的原因gapc_evt.params.disconnected.reason，可通过断连原因初步定位问题。</p></li>
</ul>
</section>
<section id="id2">
<h2>2. 常见断连原因<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<section id="x98">
<h3>2.1 0x98 超时断连<a class="headerlink" href="#x98" title="Link to this heading"></a></h3>
<p>对应BLE Spec 0x08 错误码。可能是主设备突然不发包导致从设备超时断连，也可能是从设备突然无法正常收到，导致出现超时断连。</p>
<p>出现该问题后，需先确认射频性能是否正常，即是否出现了远离或天线是否正常。如射频性能正常，需确认主设备或从设备代码调度是否正常。</p>
<p>即是否存长时间关中断，长时间占用高优先级中断的操作。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>5525\5526\5331 等芯片可通过如下方法确认调度是否正常，即isr和 start 有规律的均匀产生
typedef void (*diag_trace_func_t)(void);
extern diag_trace_func_t diag_evt_start_cbk_start_func; 
extern diag_trace_func_t diag_evt_start_cbk_done_func; 
extern diag_trace_func_t diag_ble_isr_start_func; 
extern diag_trace_func_t diag_ble_isr_done_func;

void evt_start_debug_gpio_set();
void evt_start_debug_gpio_reset();
void ble_isr_debug_gpio_set();
void ble_isr_debug_gpio_reset();

diag_evt_start_cbk_start_func = evt_start_debug_gpio_set;
diag_evt_start_cbk_done_func = evt_start_debug_gpio_reset;
diag_ble_isr_start_func = ble_isr_debug_gpio_set;
diag_ble_isr_done_func = ble_isr_debug_gpio_reset;
5515 芯片可通过如下方法确认调度是否正常，即isr和 start 有规律的均匀产生
typedef void (*diag_trace_func_t)(void);
extern diag_trace_func_t diag_evt_start_cbk_start_func; 
extern diag_trace_func_t diag_evt_start_cbk_done_func; 
extern diag_trace_func_t diag_no25_isr_start_func; 
extern diag_trace_func_t diag_no25_isr_done_func;

void evt_start_debug_gpio_set();
void evt_start_debug_gpio_reset();
void ble_isr_debug_gpio_set();
void ble_isr_debug_gpio_reset();

diag_evt_start_cbk_start_func = evt_start_debug_gpio_set;
diag_evt_start_cbk_done_func = evt_start_debug_gpio_reset;
diag_no25_isr_start_func = ble_isr_debug_gpio_set;
diag_no25_isr_done_func = ble_isr_debug_gpio_reset;
</pre></div>
</div>
</section>
<section id="xb8">
<h3>2.2 0xB8 即时指令错过<a class="headerlink" href="#xb8" title="Link to this heading"></a></h3>
<p>对应BLE Spec 0x28 错误码。指的主设备约定某一时刻经行变化的操作（信道表更新，连接参数更新，Phy更新等）。但时间过了后从设备才收到该数据包。出现的分析方法同0x98。需先确认射频性能是否正常，即是否出现了远离或天线是否正常。如射频性能正常，需确认主设备或从设备代码调度是否正常。即是否存长时间关中断，长时间占用高优先级中断的操作。</p>
</section>
<section id="xb2">
<h3>2.3 0xB2 响应超时<a class="headerlink" href="#xb2" title="Link to this heading"></a></h3>
<p>对应BLE Spec 0x22 错误码。指的是发送给对端的指令（加密请求，连接参数更新请求，数据长度更新请求，Phy更新请求等），
对端没有及时回复（40s之内）即本端出现0xB2断连,对端则出现0xA3断连，出现后需对端检查没有及时回复的原因，是否不支持本段发送的指令，或出现异常无法正常回复。</p>
</section>
<section id="xce">
<h3>2.4 0xCE 建连失败<a class="headerlink" href="#xce" title="Link to this heading"></a></h3>
<p>该断连原因常出现在主设备端。即主设备收到广播后发起连接请求，但从设备没有收到，根据Spec协议规定，主设备发出连接请求后，默认对方是可以正常收到的。主设备因此就会进入连接态。后续的6个连接间隔之内主设备若还没有正常收到从设备回复则会上报0Xce断连.出现该问题后，需确认环境是否有过多蓝牙设备。主从设备之间的距离是否太远。</p>
</section>
<section id="xa3">
<h3>2.5 0xA3 远端主动断连<a class="headerlink" href="#xa3" title="Link to this heading"></a></h3>
<p>对应BLE Spec 0x13 错误码。该断连原因较为常见，即对端设备设备主动关闭蓝牙，或应用主动断开蓝牙均会在从设备端出现该断连原因。若没有出现主动关闭或断开的操作。需抓取空口包确认在断连前40s 是否存在对端设备发起了SMP/GATT/LLCP流程，但本段设备无响应的情况。若本段支持该流程但未使能则需使能。若不支持需告知对端取消该流程。</p>
</section>
<section id="xa6">
<h3>2.6 0xA6 本端主动断连<a class="headerlink" href="#xa6" title="Link to this heading"></a></h3>
<p>对应BLE Spec 0x16 错误码。本段主动断开BLE。</p>
</section>
<section id="xcd">
<h3>2.7 0xCD 加密相关断连<a class="headerlink" href="#xcd" title="Link to this heading"></a></h3>
<p>对应BLE Spec 0x3D 错误码。</p>
<ol class="simple">
<li><p>确认两端设备是否存在清除绑定信息，修改绑定信息，修改安全参数等操作。若存在，需确认操作是否满足正常业务需求。如满足则是正常出现0xCD断连,否则需要调整流程。</p></li>
<li><p>确保在配对加密过程中不存在非配对加密的LLCP流程（连接参数更新，channel map更新，数据长度更新等一系列控制流程）插入。如果存在，则会出现0xCD断连。</p></li>
</ol>
</section>
<section id="id3">
<h3>2.8 其他断连原因<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>参考SDK_Folder\components\sdk\ble_error.h</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="index.html" class="btn btn-neutral float-left" title="BLE" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../../%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/index.html" class="btn btn-neutral float-right" title="常见问题" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2023, Goodix。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>